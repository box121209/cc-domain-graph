{"paragraphs":[{"text":"%md\n\n<h1>Playing with Common Crawl files - WARC</h1>\n\nBrowsing the S3 bucket:\n<tt>aws s3 ls s3://commoncrawl/crawl-data/</tt>\n\n<b>What this notebook does:</b>\n\nNot much yet, but is aimed at a first exploration of WARC files.","dateUpdated":"2017-10-14T09:40:37+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Playing with Common Crawl files - WARC</h1>\n<p>Browsing the S3 bucket:\n<br  /><tt>aws s3 ls s3://commoncrawl/crawl-data/</tt></p>\n<p><b>What this notebook does:</b></p>\n<p>Not much yet, but is aimed at a first exploration of WARC files.</p>\n"}]},"apps":[],"jobName":"paragraph_1507973966430_1447166678","id":"20170820-140025_400652258","dateCreated":"2017-10-14T09:39:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:177","user":"anonymous","dateFinished":"2017-10-14T09:40:38+0000","dateStarted":"2017-10-14T09:40:37+0000"},{"text":"%pyspark\n\nimport boto\nfrom boto.s3.key import Key\nfrom gzipstream import GzipStreamFile\nfrom pyspark.sql.types import *\nimport warc\n\nimport json\n\nwarclist = sc.textFile(\"s3://commoncrawl/crawl-data/CC-MAIN-2017-04/warc.paths.gz\")\nwarclist.cache()\nwarclist.count()","dateUpdated":"2017-10-14T09:39:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"57800\n"}]},"apps":[],"jobName":"paragraph_1507973966436_1431007224","id":"20170819-110935_1541563450","dateCreated":"2017-10-14T09:39:26+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:178"},{"text":"%pyspark\n\nfilename1 = warclist.take(1)[0]\nprint(filename1)\n\nconn = boto.connect_s3(anon=True, host='s3.amazonaws.com')\nbucket = conn.get_bucket('commoncrawl')\n\ndef unpack(filename):\n    key_ = Key(bucket, filename)\n    file_ = warc.WARCFile(fileobj=GzipStreamFile(key_))\n    return file_","dateUpdated":"2017-10-14T09:39:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"crawl-data/CC-MAIN-2017-04/segments/1484560279169.4/warc/CC-MAIN-20170116095119-00000-ip-10-171-10-70.ec2.internal.warc.gz\n"}]},"apps":[],"jobName":"paragraph_1507973966437_1430622475","id":"20170819-111010_432865479","dateCreated":"2017-10-14T09:39:26+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:179"},{"text":"%pyspark\n\nfrom __future__ import print_function\nfrom collections import Counter\n\nfile = unpack(filename1)\nct = [record['Content-Type'] for record in file]\n\nfor x in zip(Counter(ct).keys(), Counter(ct).values()): print(x)","dateUpdated":"2017-10-14T09:39:26+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"('application/warc-fields', 54292)\n('application/http; msgtype=response', 54291)\n('application/http; msgtype=request', 54291)\n"}]},"apps":[],"jobName":"paragraph_1507973966437_1430622475","id":"20170819-111212_335371764","dateCreated":"2017-10-14T09:39:26+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:180"},{"text":"%md\n\nCounting the records on one WARC file has taken just under a minute. For the complete set of 57800 files, one node will take ~1000 hours. \nSo to proceed further on < 1000 nodes we should work with just a small sample of files.","dateUpdated":"2017-10-14T09:39:26+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Counting the records on one WARC file has taken just under a minute. For the complete set of 57800 files, one node will take ~1000 hours.\n<br  />So to proceed further on &lt; 1000 nodes we should work with just a small sample of files.</p>\n"}]},"apps":[],"jobName":"paragraph_1507973966438_1431776722","id":"20170820-090051_1138643507","dateCreated":"2017-10-14T09:39:26+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:181"},{"text":"%pyspark\n\ndef mapper(filename):\n    file = unpack(filename)\n    return [record['Content-Type'] for record in file]\n\nsmalllist = sc.parallelize(warclist.take(12))\n\nct = smalllist.flatMap(mapper)\nct.cache()\nct.count()","dateUpdated":"2017-10-14T09:39:26+0000","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1967037\n"}]},"apps":[],"jobName":"paragraph_1507973966439_1431391973","id":"20170819-111523_1418223483","dateCreated":"2017-10-14T09:39:26+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:182"},{"text":"%pyspark\n\nct_list = ct.collect()\nfor x in zip(Counter(ct_list).keys(), Counter(ct_list).values()): print(x)","dateUpdated":"2017-10-14T09:39:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"('application/warc-fields', 655687)\n('application/http; msgtype=response', 655675)\n('application/http; msgtype=request', 655675)\n"}]},"apps":[],"jobName":"paragraph_1507973966440_1429468228","id":"20170819-124213_935095594","dateCreated":"2017-10-14T09:39:26+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:183"},{"text":"%pyspark\n","dateUpdated":"2017-10-14T09:39:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1507973966441_1429083479","id":"20170827-125500_1579378887","dateCreated":"2017-10-14T09:39:26+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:184"}],"name":"201708 common crawl 1 - WARC","id":"2CXBQ37KT","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}